<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Add formulas to a workbook • openxlsx2</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add formulas to a workbook">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">openxlsx2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.11.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/openxlsx2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/conditional-formatting.html">Add conditional formatting to a workbook</a></li>
    <li><a class="dropdown-item" href="../articles/openxlsx2_charts_manual.html">Add charts to a workbook</a></li>
    <li><a class="dropdown-item" href="../articles/openxlsx2_formulas_manual.html">Add formulas to a workbook</a></li>
    <li><a class="dropdown-item" href="../articles/openxlsx2_read_to_df.html">openxlsx2 read to data frame manual</a></li>
    <li><a class="dropdown-item" href="../articles/openxlsx2_style_manual.html">Add styling to a workbook</a></li>
    <li><a class="dropdown-item" href="../articles/Update-from-openxlsx.html">Upgrade from openxlsx</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JanMarvin/openxlsx2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Add formulas to a workbook</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JanMarvin/openxlsx2/blob/main/vignettes/openxlsx2_formulas_manual.Rmd" class="external-link"><code>vignettes/openxlsx2_formulas_manual.Rmd</code></a></small>
      <div class="d-none name"><code>openxlsx2_formulas_manual.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://janmarvin.github.io/openxlsx2/">openxlsx2</a></span><span class="op">)</span></span></code></pre></div>
<p>Below you find various examples how to create formulas with
<code>openxlsx2</code>. Though, before we start with the examples, let
us begin with a word of warning. Please be aware, while it is possible
to create all these formulas, they are not evaluated unless they are
opened in spreadsheet software. Even worse, if there are cells
containing the result of some formula, it can not be trusted unless the
formula is evaluated in spreadsheet software.</p>
<p>This can be shown in a simple example: We have a spreadsheet with a
formula <code>A1 + B1</code>. This formula was evaluated with
spreadsheet software as <code>A1 + B1 = 2</code>. Therefore if we read
the cell, we see the value 2. Lets recreate this output in
<code>openxlsx2</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create artificial xlsx file</span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>dims <span class="op">=</span> <span class="st">"C1"</span>, x <span class="op">=</span> <span class="st">"A1 + B1"</span><span class="op">)</span></span>
<span><span class="co"># Users should never modify cc as shown here</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="va">worksheets</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sheet_data</span><span class="op">$</span><span class="va">cc</span><span class="op">$</span><span class="va">v</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># we expect a value of 2</span></span>
<span><span class="fu"><a href="../reference/wb_to_df.html">wb_to_df</a></span><span class="op">(</span><span class="va">wb</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B C</span></span>
<span><span class="co">#&gt; 1 1 1 2</span></span></code></pre></div>
<p>Now, lets assume we modify the data in cell <code>A1</code> to 2.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span><span class="op">$</span><span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we expect 3</span></span>
<span><span class="fu"><a href="../reference/wb_to_df.html">wb_to_df</a></span><span class="op">(</span><span class="va">wb</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B C</span></span>
<span><span class="co">#&gt; 1 2 1 2</span></span></code></pre></div>
<p>What happened? Even though we see cells <code>A1</code> and
<code>B1</code> show a value of <code>2</code> and <code>1</code> our
formula in <code>C1</code> was not updated. It still shows a value of
<code>2</code>. This is because <code>openxlsx2</code> does not evaluate
formulas and workbooks on a more general scale. In the open xml style
the cell looks something like this:</p>
<pre><code>&lt;c r="C1"&gt;
  &lt;f&gt;A1 + B1&lt;/f&gt;
  &lt;v&gt;2&lt;/v&gt;
&lt;/c&gt;</code></pre>
<p>And when we read from this cell, we always return the value of
<code>v</code>. In this case it is obvious, but still wrong and it is a
good idea to check if underlying fields contain formulas.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wb_to_df.html">wb_to_df</a></span><span class="op">(</span><span class="va">wb</span>, col_names <span class="op">=</span> <span class="cn">FALSE</span>, show_formula <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   A B       C</span></span>
<span><span class="co">#&gt; 1 2 1 A1 + B1</span></span></code></pre></div>
<p>If <code>openxlsx2</code> writes formulas, as shown in the examples
below, the fields will be entirely blank. These fields will only be
evaluated and filled, once the output file is opened in spreadsheet
software.</p>
<p>The only way to avoid surprises is to be aware of this all the time
and similar, checking for similar things all the time.</p>
<div class="section level2">
<h2 id="simple-formulas">Simple formulas<a class="anchor" aria-label="anchor" href="#simple-formulas"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"SUM(A2, B2)"</span>, dims <span class="op">=</span> <span class="st">"D2"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"A2 + B2"</span>, dims <span class="op">=</span> <span class="st">"D3"</span><span class="op">)</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="array-formulas">Array formulas<a class="anchor" aria-label="anchor" href="#array-formulas"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"A2:A7 * B2:B7"</span>, dims <span class="op">=</span> <span class="st">"C2:C7"</span>, array <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="array-formulas-creating-multiple-fields">Array formulas creating multiple fields<a class="anchor" aria-label="anchor" href="#array-formulas-creating-multiple-fields"></a>
</h2>
<p>In the example below we want to use <code>MMULT()</code> which
creates a matrix multiplication. This requires us to write an array
formula and to specify the region where the output will be written
to.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="va">m1</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="va">m2</span>, dims <span class="op">=</span> <span class="fu"><a href="../reference/wb_dims.html">wb_dims</a></span><span class="op">(</span>from_col <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"MMULT(A2:B4, D2:F3)"</span>, dims <span class="op">=</span> <span class="st">"H2:J4"</span>, array <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
<p>Similar a the coefficients of a linear regression</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we expect to find this in D1:E1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)        dist </span></span>
<span><span class="co">#&gt;   5.2692308   0.1153846</span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"LINEST(A2:A7, B2:B7, TRUE)"</span>, dims <span class="op">=</span> <span class="st">"D2:E2"</span>, array <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cells-metadata-cm-formulas">cells metadata (cm) formulas<a class="anchor" aria-label="anchor" href="#cells-metadata-cm-formulas"></a>
</h2>
<p>Similar to array formulas, these cell metadata (cm) formulas hide to
the user that they are array formulas. Using these is implemented in
<code>openxlsx2</code> &gt; 0.6.1:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"SUM(ABS(A2:A7))"</span>, dims <span class="op">=</span> <span class="st">"D2"</span>, cm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in write_data2(wb = wb, sheet = sheet, data = x, name = name, colNames</span></span>
<span><span class="co">#&gt; = colNames, : modifications with cm formulas are experimental. use at own risk</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="datatable-formulas">
<code>dataTable</code> formulas<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;this example was originally provided by &lt;span class="citation"&gt;@zykezero&lt;/span&gt; for &lt;code&gt;openxlsx&lt;/code&gt;.&lt;/p&gt;'><sup>1</sup></a><a class="anchor" aria-label="anchor" href="#datatable-formulas"></a>
</h2>
<div class="section level5">
<h5 id="datatable-formula-differences">
<code>dataTable</code> formula differences<a class="anchor" aria-label="anchor" href="#datatable-formula-differences"></a>
</h5>
<table class="table">
<thead><tr class="header">
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>sales_price</td>
<td>COGS</td>
<td>sales_quantity</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>5</td>
<td>1</td>
</tr>
<tr class="odd">
<td>3</td>
<td>30</td>
<td>11</td>
<td>2</td>
</tr>
<tr class="even">
<td>4</td>
<td>40</td>
<td>13</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Given a basic table like the above, a similarly basic formula for
<code>total_sales</code> would be “= A2 * C2” with the row value
changing at each row.</p>
<p>An implementation for this formula using
<code><a href="../reference/wb_add_formula.html">wb_add_formula()</a></code> would look this (taken from current
documentation) lets say we’ve read in the data and assigned it to the
table <code>company_sales</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## creating example data</span></span>
<span><span class="va">company_sales</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    sales_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>    COGS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span>,</span>
<span>    sales_quantity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## write in the formula</span></span>
<span><span class="va">company_sales</span><span class="op">$</span><span class="va">total_sales</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1L</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" * "</span><span class="op">)</span></span>
<span><span class="co">## add the formula class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">company_sales</span><span class="op">$</span><span class="va">total_sales</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">company_sales</span><span class="op">$</span><span class="va">total_sales</span><span class="op">)</span>, <span class="st">"formula"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## write a workbook</span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wb_workbook.html">wb_workbook</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_worksheet</span><span class="op">(</span><span class="st">"Total Sales"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data_table</span><span class="op">(</span>x <span class="op">=</span> <span class="va">company_sales</span><span class="op">)</span></span></code></pre></div>
<p>Then we create the workbook, worksheet, and use
<code><a href="../reference/wb_add_data_table.html">wb_add_data_table()</a></code>.</p>
<p>One of the advantages of the open xml <code>dataTable</code> syntax
is that we don’t have to specify row numbers or columns as letters. The
table also grows dynamically, adding new rows as new data is appended
and extending formulas to the new rows. These <code>dataTable</code>
have named columns that we can use instead of letters. When writing the
formulas within the <code>dataTable</code> we would use the following
syntax <code>[@[column_name]]</code> to reference the current row. So
the “total_sales” formula written in open xml in <code>dataTable</code>
would look like this;
<code>=[@[sales_price]] * [@[sales_quantity]]</code></p>
<p>If we are writing the formula outside of the <code>dataTable</code>
we have to reference the table name. In this case lets say the table
name is ‘daily_sales’
<code>=daily_sales[@[sales_price]] * daily_sales[@[sales_quantity]]</code></p>
<p>However, if we were to pass this as the text for the formula to be
written it would cause an error because the syntax that open xml
requires for selecting the current row is different.</p>
<p>In open xml the <code>dataTable</code> formula looks like this:</p>
<pre><code>&lt;calculatedColumnFormula&gt;
  daily_sales[[#This Row],[sales_price]]*daily_sales[[#ThisRow],[sales_quantity]]
&lt;/calculatedColumnFormula&gt;</code></pre>
<p>Now we can see that open xml replaces <code>[@[sales_price]]</code>
with <code>daily_sales[[#This Row],[sales_price]]</code> We must then
use this syntax when writing formulas for <code>dataTable</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Because we want the `dataTable` formula to propagate down the entire column of the data</span></span>
<span><span class="co">## we can assign the formula by itself to any column and allow that single string to be repeated for each row.</span></span>
<span></span>
<span><span class="co">## creating example data</span></span>
<span><span class="va">example_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    sales_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>    COGS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">11</span>, <span class="fl">13</span><span class="op">)</span>,</span>
<span>    sales_quantity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## base R method</span></span>
<span><span class="va">example_data</span><span class="op">$</span><span class="va">gross_profit</span>       <span class="op">&lt;-</span> <span class="st">"daily_sales[[#This Row],[sales_price]] - daily_sales[[#This Row],[COGS]]"</span></span>
<span><span class="va">example_data</span><span class="op">$</span><span class="va">total_COGS</span>        <span class="op">&lt;-</span> <span class="st">"daily_sales[[#This Row],[COGS]] * daily_sales[[#This Row],[sales_quantity]]"</span></span>
<span><span class="va">example_data</span><span class="op">$</span><span class="va">total_sales</span>       <span class="op">&lt;-</span> <span class="st">"daily_sales[[#This Row],[sales_price]] * daily_sales[[#This Row],[sales_quantity]]"</span></span>
<span><span class="va">example_data</span><span class="op">$</span><span class="va">total_gross_profit</span> <span class="op">&lt;-</span> <span class="st">"daily_sales[[#This Row],[total_sales]] - daily_sales[[#This Row],[total_COGS]]"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">gross_profit</span><span class="op">)</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">gross_profit</span><span class="op">)</span>,       <span class="st">"formula"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_COGS</span><span class="op">)</span>        <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_COGS</span><span class="op">)</span>,          <span class="st">"formula"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_sales</span><span class="op">)</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_sales</span><span class="op">)</span>,         <span class="st">"formula"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_gross_profit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">$</span><span class="va">total_gross_profit</span><span class="op">)</span>, <span class="st">"formula"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span><span class="op">$</span></span>
<span>  <span class="fu">add_worksheet</span><span class="op">(</span><span class="st">"Daily Sales"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">add_data_table</span><span class="op">(</span></span>
<span>    x           <span class="op">=</span> <span class="va">example_data</span>,</span>
<span>    table_style <span class="op">=</span> <span class="st">"TableStyleMedium2"</span>,</span>
<span>    table_name  <span class="op">=</span> <span class="st">"daily_sales"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And if we open the workbook to view the table we created we can see
that the formula has worked.</p>
<table class="table">
<colgroup>
<col width="7%">
<col width="31%">
<col width="14%">
<col width="36%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>sales_price</td>
<td>COGS</td>
<td>sales_quantity</td>
<td>gross_profit</td>
<td>total_COGS</td>
<td>total_sales</td>
<td>total_gross_profit</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>5</td>
<td>1</td>
<td>15</td>
<td>5</td>
<td>20</td>
<td>15</td>
</tr>
<tr class="odd">
<td>3</td>
<td>30</td>
<td>11</td>
<td>2</td>
<td>19</td>
<td>22</td>
<td>60</td>
<td>38</td>
</tr>
<tr class="even">
<td>4</td>
<td>40</td>
<td>13</td>
<td>3</td>
<td>27</td>
<td>39</td>
<td>120</td>
<td>81</td>
</tr>
</tbody>
</table>
<p>We can also see that it has replaced <code>[#This Row]</code> with
<code>@</code>.</p>
<table class="table">
<colgroup>
<col width="1%">
<col width="7%">
<col width="3%">
<col width="9%">
<col width="15%">
<col width="18%">
<col width="22%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>sales_price</td>
<td>COGS</td>
<td>sales_quantity</td>
<td>gross_profit</td>
<td>total_COGS</td>
<td>total_sales</td>
<td>total_gross_profit</td>
</tr>
<tr class="even">
<td>2</td>
<td>20</td>
<td>5</td>
<td>1</td>
<td>=<span class="citation">[@sales_price]</span> - <span class="citation">[@COGS]</span>
</td>
<td>=<span class="citation">[@COGS]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=<span class="citation">[@sales_price]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=[@[total_sales]] - [@[total_COGS]]</td>
</tr>
<tr class="odd">
<td>3</td>
<td>30</td>
<td>11</td>
<td>2</td>
<td>=<span class="citation">[@sales_price]</span> - <span class="citation">[@COGS]</span>
</td>
<td>=<span class="citation">[@COGS]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=<span class="citation">[@sales_price]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=[@[total_sales]] - [@[total_COGS]]</td>
</tr>
<tr class="even">
<td>4</td>
<td>40</td>
<td>13</td>
<td>3</td>
<td>=<span class="citation">[@sales_price]</span> - <span class="citation">[@COGS]</span>
</td>
<td>=<span class="citation">[@COGS]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=<span class="citation">[@sales_price]</span> * <span class="citation">[@sales_quantity]</span>
</td>
<td>=[@[total_sales]] - [@[total_COGS]]</td>
</tr>
</tbody>
</table>
<p>For completion, the formula as we wrote it appears as;</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="24%">
<col width="28%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>D</th>
<th>E</th>
<th>F</th>
<th>G</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>gross_profit</td>
<td>total_COGS</td>
<td>total_sales</td>
<td>total_gross_profit</td>
</tr>
<tr class="even">
<td>=gross_profit[[#This Row],[sales_price]] - gross_profit[[#This
Row],[COGS]]</td>
<td>=gross_profit[[#This Row],[COGS]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[sales_price]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[total_sales]] - gross_profit[[#This
Row],[total_COGS]]</td>
</tr>
<tr class="odd">
<td>=gross_profit[[#This Row],[sales_price]] - gross_profit[[#This
Row],[COGS]]</td>
<td>=gross_profit[[#This Row],[COGS]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[sales_price]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[total_sales]] - gross_profit[[#This
Row],[total_COGS]]</td>
</tr>
<tr class="even">
<td>=gross_profit[[#This Row],[sales_price]] - gross_profit[[#This
Row],[COGS]]</td>
<td>=gross_profit[[#This Row],[COGS]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[sales_price]] * gross_profit[[#This
Row],[sales_quantity]]</td>
<td>=gross_profit[[#This Row],[total_sales]] - gross_profit[[#This
Row],[total_COGS]]</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### sum dataTable examples</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="st">"sum_examples"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Note: dataTable formula do not need to be used inside of dataTables. dataTable formula are for referencing the data within the dataTable.</span></span>
<span></span>
<span><span class="co">### Note: dataTable formula do not need to be used inside of dataTables. dataTable formula are for referencing the data within the dataTable.</span></span>
<span><span class="va">sum_examples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sum_sales_price"</span>, <span class="st">"sum_product_Price_Quantity"</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_data</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sum_examples</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add formulas</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"sum(daily_sales[[#Data],[sales_price]])"</span>, dims <span class="op">=</span> <span class="st">"B2"</span><span class="op">)</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_formula</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"sum(daily_sales[[#Data],[sales_price]] * daily_sales[[#Data],[sales_quantity]])"</span>, dims <span class="op">=</span> <span class="st">"B3"</span>, array <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### dataTable referencing</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_worksheet</span><span class="op">(</span><span class="st">"dt_references"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Adding the headers by themselves.</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_formula</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="st">"daily_sales[[#Headers],[sales_price]:[total_gross_profit]]"</span>,</span>
<span>  dims <span class="op">=</span> <span class="st">"A1:G1"</span>,</span>
<span>  array <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Adding the raw data by reference and selecting them directly.</span></span>
<span><span class="va">wb</span><span class="op">$</span><span class="fu">add_formula</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="st">"daily_sales[[#Data],[sales_price]:[total_gross_profit]]"</span>,</span>
<span>  start_row <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dims <span class="op">=</span> <span class="st">"A2:G4"</span>,</span>
<span>  array <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># wb$open()</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jordan Mark Barbone, Jan Marvin Garbuszus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
